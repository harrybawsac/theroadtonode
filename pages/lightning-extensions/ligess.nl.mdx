import Callout from "nextra-theme-docs/callout";

# Ligess

<Callout emoji="&#x2139;">
	Tijd: 20 minuten
</Callout>

Met Ligess configureer je een eigen [lightning address](https://lightningaddress.com/) server die verbonden is met jouw node. Meer informatie lees je in de [Github repository](https://github.com/Dolu89/ligess).
![](https://i.imgur.com/DIV5q8q.png)

## Benodigdheden

* [NodeJS](/nl/raspberry-pi/common-dependencies#nodejs)
* Een [Lightning node](/nl/lightning/installation)
* Domeinnaam die verwijst naar jouw server waarop je Ligess installeert

## Installatie

Navigeer naar je home directory.
```bash
cd ~
```

Haal de broncode op en clone de Git repository.
```bash
git clone https://github.com/dolu89/ligess
```

Duik de code in.
```bash
cd ~/ligess
```

Installeer Ligess.
```bash
npm install
```

Maak een kopie van het `.env.example` bestand en noem deze `.env`.
```bash
cp .env.example .env
```

Pas dit bestand aan met jouw .env variablen.
```bash
nano .env
```
Sla het op met `Ctrl + X` en bevestig met `Y`.

Voorbeeld:

```bash
LIGESS_USERNAME=jouw_naam
LIGESS_DOMAIN=jouwdomeinnaam.com

LIGESS_LN_BACKEND=LND

LIGESS_LND_REST=https://0.0.0.0:8080
LIGESS_LND_MACAROON=[...]

HOST=127.0.0.1
PORT=8088
```
Bij `LIGESS_LND_MACAROON` dien je een hex encoded macaroon te plaatsen waar in het voorbeeld `[...]` staat.
Om een macaroon in hex format te aan maken, kun je https://github.com/ZeusLN/lnd-hex-macaroon-generator gebruiken.
Als je deze tool hebt geÃ¯nstalleerd, gebruik je deze als volgt:
```bash
node index.js
> /home/ubuntu/.lnd/data/chain/bitcoin/mainnet/backup/invoice.macaroon
```

De output vul je in bij `LIGESS_LND_MACAROON` in `.env`.

## Firewall

Zet port 8088 open.

```bash
sudo ufw allow 8088 comment "Ligess"
```

Jouw lightning address ziet er nu als volgt uit: `jouw_naam@jouwdomein.com`

Test of Ligess werkt door de applicatie te starten:
```bash
yarn dev
```
Open vervolgens deze link in je browser:
`http://localhost:8088/.well-known/lnurlp/jouw_naam`

## Automatiseer

```bash
sudo nano /etc/systemd/system/ligess.service
```

Plak het volgende erin.
```bash
[Unit]
Description=Ligess
Requires=lnd.service
After=lnd.service

[Service]
User=ubuntu
WorkingDirectory=/home/ubuntu/ligess
ExecStart=yarn dev
Restart=always
TimeoutSec=120
RestartSec=30

[Install]
WantedBy=multi-user.target
```

Sla het weer op met `Ctrl + X` en bevestig met `Y`.

Het systeem moet op de hoogte gesteld worden van de nieuwe service en kan daarna gestart worden.

```bash
sudo systemctl enable ligess
```
```bash
sudo systemctl start ligess
```
Wil je zien of alles goed is opgestart, voer dan dit uit:

```bash
systemctl status ligess
```

Wil je een overzicht van de status over meerdere sessie, gebruik dan dit:
```bash
sudo journalctl -f -u ligess
```

## Server

Lokaal werkt je setup nu, maar jouw lightning address is nog niet van buitenaf bereikbaar. Daarvoor kun je een Nginx reverse proxy webserver setup gebruiken.
Installeer Nginx:

```bash
sudo apt install -y nginx
```

Je dient ook Certbot te installeren om een Let's Encrypt SSL certificaat aan te maken:

```bash
sudo apt install -y certbot python3-certbot-nginx
```

Zet port 80 en 443 open voor Nginx:

```bash
sudo ufw allow 'Nginx Full'
```

Maak het Nginx configuratie bestand aan voor Ligess:

```bash
sudo nano /etc/nginx/ligess.conf
```

Plak daarin de volgende tekst en vervang op de plekken waar `jouwdomeinnaam.com` staat met jouw eigen domeinnaam:

```bash
upstream lnurlp {
    server 127.0.0.1:8088;
}
server {
    server_name jouwdomeinnaam.com;

    listen [::]:443 ssl http2; # managed by Certbot
    listen 443 ssl http2; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/jouwdomeinnaam.com/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/jouwdomeinaam.com/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;

    location /.well-known/lnurlp/ {
        if ($request_method = 'GET') {
            add_header 'Access-Control-Allow-Origin' '*';
        }
        proxy_pass http://lnurlp;
    }
}
server {
    if ($host = jouwdomeinnaam.com) {
        return 301 https://$host$request_uri;
    }

    server_name jouwdomeinnaam.com;

    listen 80;
    listen [::]:80;
    return 404;
}
```

Sla het op met `Ctrl + X` en bevestigen met `Y`.
Je kunt de configuratie controleren met `sudo nginx -t` waarvan de output moet lijken op:

```bash
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
```

Om de Ligess Nginx configuratie in te laden herstart je Nginx met `sudo systemctl restart nginx`.

Je kunt nu een SSL certificaat met Certbot aanmaken:

```bash
sudo certbot --nginx -d jouwdomeinnaam.com
```

## Updaten

Ga naar de applicatie directory.

```bash
cd ~/ligess
```

Update de repository met de laatste wijzigingen via Git.

```bash
git fetch --all
```
```bash
git pull
```

Installeer de software.

```bash
npm install
```

Herstart de Ligess service.

```bash
sudo systemctl restart ligess
```

Ligess is nu bijgewerkt!

## Gebruiken

Om gebruik te maken van je eigen lightning address dien je een wallet te gebruiken die dit ondersteund. Een complete lijst vind je [hier](https://github.com/andrerfneves/lightning-address#wallets-supported).

Je kunt je lightning address ook testen / decoden op [https://lightningdecoder.com](https://lightningdecoder.com) waar je `jouw_naam@jouwdomein.com` invult bij Enter Invoice.